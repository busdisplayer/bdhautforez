<!DOCTYPE html>
<html lang="fr">
<head>
  <title>Bd du Ht Forez - Transports en commun</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <script>
    let stateHor = -1; // -1 = erreur ou Ã©tat inconnu
    let wedBool = false;
    let horairesEncours = [];

    const horairesParStatut = {
      0: ["Pas de service"], // Dimanche
      1: ["06:30", "07:30", "08:30", "12:00", "16:30", "18:00"], // Semaine scolaire
      2: ["07:00", "08:00", "12:30", "17:00"], // Mercredi
      3: ["08:00", "10:00", "12:00", "14:00"], // Samedi
      4: ["Pas de service"], // Jour fÃ©riÃ©
      5: ["08:30", "10:30", "14:00", "17:00"], // Vacances scolaires
      6: ["09:00", "11:00", "15:00", "18:00"], // Vacances d'Ã©tÃ©
    };

    function getApiUrl() {
      const currentYear = new Date().getFullYear();
      return `https://data.education.gouv.fr/api/explore/v2.1/catalog/datasets/fr-en-calendrier-scolaire/records?limit=20&refine=start_date%3A%22${currentYear}%22&refine=zones%3A%22Zone%20A%22&refine=location%3A%22Lyon%22&refine=population%3A%22-%22`;
    }

    function getStatusDescription(code) {
      switch (code) {
        case 0: return "Dimanche";
        case 1: return "Semaine scolaire (Lundi, Mardi, Jeudi, Vendredi)";
        case 2: return "Mercredi";
        case 3: return "Samedi";
        case 4: return "Jour fÃ©riÃ©";
        case 5: return "Semaine de vacances scolaires";
        case 6: return "Vacances d'Ã©tÃ©";
        default: return "Ã‰tat inconnu";
      }
    }

    function getHorairesDuJour(code) {
      return horairesParStatut[code] || ["Erreur : Statut inconnu"];
    }

    async function getVacationStatus() {
      const url = getApiUrl();
      try {
        const response = await fetch(url);
        const data = await response.json();
        if (!data.results) throw new Error("DonnÃ©es non disponibles");

        const today = new Date();
        const dayOfWeek = today.getDay(); // 0 = Dimanche, 6 = Samedi
        let status = 1; // Par dÃ©faut : semaine scolaire

        if (dayOfWeek === 3) {
          status = 2; // Mercredi
          wedBool = true;
        } else if (dayOfWeek === 0) {
          status = 0; // Dimanche
        } else if (dayOfWeek === 6) {
          status = 3; // Samedi
        }

        const publicHolidays = ["2025-01-01", "2025-05-01", "2025-07-14", "2025-12-25"];
        const todayStr = today.toISOString().split("T")[0];
        if (publicHolidays.includes(todayStr)) {
          status = 4; // Jour fÃ©riÃ©
        }

        for (const vacation of data.results) {
          const startDate = new Date(vacation.start_date);
          const endDate = new Date(vacation.end_date);
          if (today >= startDate && today <= endDate) {
            status = vacation.description.includes("Ã‰tÃ©") ? 6 : 5;
            break;
          }
        }

        stateHor = status;
        horairesEncours = getHorairesDuJour(stateHor);

        // Logs dÃ©taillÃ©s
        console.log("âœ… Statut dÃ©tectÃ© :", stateHor);
        console.log("ðŸ“… Explication :", getStatusDescription(stateHor));
        console.log("ðŸ•’ Horaires du jour :", horairesEncours);
        if (wedBool) console.log("ðŸ”” Aujourd'hui est un mercredi.");

      } catch (error) {
        console.error("âŒ Erreur lors de la rÃ©cupÃ©ration des donnÃ©es :", error);
      }
    }

    // Lancer tout Ã§a
    getVacationStatus();
  </script>
</body>
</html>
